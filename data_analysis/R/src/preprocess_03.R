# Unit conversions
W_to_mm <- 0.408*3600*24/10^6

# Psychrometric constant
gamma <- 0.066

# Clausius-Clapeyron parameters (Katul et al. 2012)
a <- 0.6111
b <- 17.5
c <- 240.97

# # Clausius-Clapeyron parameters (Savage 2009)
# a <- 0.6108
# b <- 17.2694
# c <- 237.3

# b*c* e_sat/(c + Tair)^2
# b*c* (a*exp(b*Tair/(Tair+c)))/(c + Tair)^2

# Priestley-Taylor coefficient
alpha_PT <- 1.26


##############################################
# The logic of this needs to be double-checked

# Function for annual sum
annSums <- function(x){
  
  if(nrow(x) != 12){
    stop('There must be excatly 12 lines each representing one month\n')
  }
  x[1,] <- x[1,]*31
  x[2,] <-x[2,]*28.25
  x[3,] <-x[3,]*31
  x[4,] <-x[4,]*30
  x[5,] <-x[5,]*31
  x[6,] <-x[6,]*30
  x[7,] <-x[7,]*31
  x[8,] <-x[8,]*31
  x[9,] <-x[9,]*30
  x[10,] <-x[10,]*31
  x[11,] <-x[11,]*30
  x[12,] <-x[12,]*31
  y <- 12* colMeans(x,na.rm=TRUE)/mean(c(31,28.25,31,30,31,30,31,31,30,31,30,31))
  
  return(y)
}

# Function for annual sum
annMean <- function(x){
  
  if(nrow(x) != 12){
    stop('There must be excatly 12 lines each representing one month\n')
  }
  x[1,] <- x[1,]*31
  x[2,] <-x[2,]*28.25
  x[3,] <-x[3,]*31
  x[4,] <-x[4,]*30
  x[5,] <-x[5,]*31
  x[6,] <-x[6,]*30
  x[7,] <-x[7,]*31
  x[8,] <-x[8,]*31
  x[9,] <-x[9,]*30
  x[10,] <-x[10,]*31
  x[11,] <-x[11,]*30
  x[12,] <-x[12,]*31
  y <- colMeans(x,na.rm=TRUE)/mean(c(31,28.25,31,30,31,30,31,31,30,31,30,31))
  
  return(y)
}

######################
# Temporal sub-setting
CMIP5_1981_2005_data <- CMIP5_data[which(CMIP5_data$PERIOD=='1981_2005'),]
CMIP5_2076_2100_data <- CMIP5_data[which(CMIP5_data$PERIOD=='2076_2100'),]

CMIP6_1981_2005_data <- CMIP6_data[which(CMIP6_data$PERIOD=='1981_2005'),]
CMIP6_2076_2100_data <- CMIP6_data[which(CMIP6_data$PERIOD=='2076_2100'),]

RCMs_1981_2005_data <- RCMs_data[which(RCMs_data$PERIOD=='1981_2005'),]
RCMs_2076_2100_data <- RCMs_data[which(RCMs_data$PERIOD=='2076_2100'),]

# Select the column with variables
CMIP5_1981_2005 <- 2:(ncol(CMIP5_1981_2005_data)-2)
CMIP5_2076_2100 <- 2:(ncol(CMIP5_2076_2100_data)-2)
CMIP6_1981_2005 <- 2:(ncol(CMIP6_1981_2005_data)-2)
CMIP6_2076_2100 <- 2:(ncol(CMIP6_2076_2100_data)-2)
RCMs_1981_2005 <- 2:(ncol(RCMs_1981_2005_data)-2)
RCMs_2076_2100 <- 2:(ncol(RCMs_2076_2100_data)-2)

############################
# Fluxes and state variables

#-----
# CMIP5

LE_CMIP5_1981_2005 <- CMIP5_1981_2005_data[which(CMIP5_1981_2005_data$VAR=='LE'),]
LE_CMIP5_2076_2100 <- CMIP5_2076_2100_data[which(CMIP5_2076_2100_data$VAR=='LE'),]

H_CMIP5_1981_2005 <- CMIP5_1981_2005_data[which(CMIP5_1981_2005_data$VAR=='H'),]
H_CMIP5_2076_2100 <- CMIP5_2076_2100_data[which(CMIP5_2076_2100_data$VAR=='H'),]

Rg_CMIP5_1981_2005 <- CMIP5_1981_2005_data[which(CMIP5_1981_2005_data$VAR=='Rg'),]
Rg_CMIP5_2076_2100 <- CMIP5_2076_2100_data[which(CMIP5_2076_2100_data$VAR=='Rg'),]

SW_net_CMIP5_1981_2005 <- CMIP5_1981_2005_data[which(CMIP5_1981_2005_data$VAR=='SW_net'),]
SW_net_CMIP5_2076_2100 <- CMIP5_2076_2100_data[which(CMIP5_2076_2100_data$VAR=='SW_net'),]

LW_net_CMIP5_1981_2005 <- CMIP5_1981_2005_data[which(CMIP5_1981_2005_data$VAR=='LW_net'),]
LW_net_CMIP5_2076_2100 <- CMIP5_2076_2100_data[which(CMIP5_2076_2100_data$VAR=='LW_net'),]

# Correct the sign
LW_net_CMIP5_1981_2005[,CMIP5_1981_2005] <- (-1)*LW_net_CMIP5_1981_2005[,CMIP5_1981_2005]
LW_net_CMIP5_2076_2100[,CMIP5_2076_2100] <- (-1)*LW_net_CMIP5_2076_2100[,CMIP5_2076_2100]

Rn_CMIP5_1981_2005 <- SW_net_CMIP5_1981_2005
Rn_CMIP5_1981_2005[,CMIP5_1981_2005] <- SW_net_CMIP5_1981_2005[,CMIP5_1981_2005]+LW_net_CMIP5_1981_2005[,CMIP5_1981_2005]
Rn_CMIP5_2076_2100 <- SW_net_CMIP5_2076_2100
Rn_CMIP5_2076_2100[,CMIP5_1981_2005] <- SW_net_CMIP5_2076_2100[,CMIP5_2076_2100]+LW_net_CMIP5_2076_2100[,CMIP5_2076_2100]
Rn_CMIP5_1981_2005$VAR <- 'Rn'
Rn_CMIP5_2076_2100$VAR <- 'Rn'

G_CMIP5_1981_2005 <- Rn_CMIP5_1981_2005
G_CMIP5_1981_2005[,CMIP5_1981_2005] <- Rn_CMIP5_1981_2005[,CMIP5_1981_2005]-H_CMIP5_1981_2005[,CMIP5_1981_2005]-LE_CMIP5_1981_2005[,CMIP5_1981_2005]
G_CMIP5_2076_2100 <- Rn_CMIP5_2076_2100
G_CMIP5_2076_2100[,CMIP5_2076_2100] <- Rn_CMIP5_2076_2100[,CMIP5_2076_2100]-H_CMIP5_2076_2100[,CMIP5_2076_2100]-LE_CMIP5_2076_2100[,CMIP5_2076_2100]
G_CMIP5_1981_2005$VAR <- 'G'
G_CMIP5_2076_2100$VAR <- 'G'

P_CMIP5_1981_2005 <- CMIP5_1981_2005_data[which(CMIP5_1981_2005_data$VAR=='P'),]
P_CMIP5_2076_2100 <- CMIP5_2076_2100_data[which(CMIP5_2076_2100_data$VAR=='P'),]

Ta_CMIP5_1981_2005 <- CMIP5_1981_2005_data[which(CMIP5_1981_2005_data$VAR=='Ta'),]
Ta_CMIP5_2076_2100 <- CMIP5_2076_2100_data[which(CMIP5_2076_2100_data$VAR=='Ta'),]

n_days_CMIP5 <- matrix(rep(c(31,28.25,31,30,31,30,31,31,30,31,30,31),ncol(CMIP5_1981_2005_data)-4),nrow=12,ncol=ncol(CMIP5_1981_2005_data)-4)
ET_CMIP5_1981_2005 <- LE_CMIP5_1981_2005
ET_CMIP5_1981_2005[,CMIP5_1981_2005] <- LE_CMIP5_1981_2005[,CMIP5_1981_2005]*n_days_CMIP5*W_to_mm
ET_CMIP5_2076_2100 <- LE_CMIP5_2076_2100
ET_CMIP5_2076_2100[,CMIP5_2076_2100] <- LE_CMIP5_2076_2100[,CMIP5_2076_2100]*n_days_CMIP5*W_to_mm
### ET_CMIP5_2076_2100 <- LE_CMIP5_2076_2100


# Clausius-Clapeyron
e_sat_CMIP5_1981_2005 <- Ta_CMIP5_1981_2005
e_sat_CMIP5_2076_2100 <- Ta_CMIP5_2076_2100

e_sat_CMIP5_1981_2005[,CMIP5_1981_2005] <- a*exp(b*Ta_CMIP5_1981_2005[,CMIP5_1981_2005]/(Ta_CMIP5_1981_2005[,CMIP5_1981_2005]+c))
e_sat_CMIP5_2076_2100[,CMIP5_2076_2100] <- a*exp(b*Ta_CMIP5_2076_2100[,CMIP5_2076_2100]/(Ta_CMIP5_2076_2100[,CMIP5_2076_2100]+c))
e_sat_CMIP5_1981_2005$VAR <- 'e_sat'
e_sat_CMIP5_2076_2100$VAR <- 'e_sat'


SVP_CMIP5_1981_2005 <- Ta_CMIP5_1981_2005
SVP_CMIP5_2076_2100 <- Ta_CMIP5_2076_2100

SVP_CMIP5_1981_2005[,CMIP5_1981_2005] <- b*c* e_sat_CMIP5_1981_2005[,CMIP5_1981_2005]/(c + Ta_CMIP5_1981_2005[,CMIP5_1981_2005])^2
SVP_CMIP5_2076_2100[,CMIP5_2076_2100] <- b*c* e_sat_CMIP5_2076_2100[,CMIP5_2076_2100]/(c + Ta_CMIP5_2076_2100[,CMIP5_2076_2100])^2
SVP_CMIP5_1981_2005$VAR <- 'SVP'
SVP_CMIP5_2076_2100$VAR <- 'SVP'

# Equilibrium evaporation
ET_eq_CMIP5_1981_2005 <- Ta_CMIP5_1981_2005
ET_eq_CMIP5_2076_2100 <- Ta_CMIP5_2076_2100

ET_eq_CMIP5_1981_2005[,CMIP5_1981_2005] <- SVP_CMIP5_1981_2005[,CMIP5_1981_2005]*(Rn_CMIP5_1981_2005[,CMIP5_1981_2005]-G_CMIP5_1981_2005[,CMIP5_1981_2005])/(SVP_CMIP5_1981_2005[,CMIP5_1981_2005] + gamma)*n_days_CMIP5*W_to_mm
ET_eq_CMIP5_2076_2100[,CMIP5_2076_2100] <- SVP_CMIP5_2076_2100[,CMIP5_2076_2100]*(Rn_CMIP5_2076_2100[,CMIP5_2076_2100]-G_CMIP5_2076_2100[,CMIP5_2076_2100])/(SVP_CMIP5_2076_2100[,CMIP5_2076_2100] + gamma)*n_days_CMIP5*W_to_mm

ET_eq_CMIP5_1981_2005$VAR <- 'Equilibrium_ET'
ET_eq_CMIP5_2076_2100$VAR <- 'Equilibrium_ET'

# Replace negative values by zero
ET_eq_CMIP5_1981_2005[,CMIP5_1981_2005][ET_eq_CMIP5_1981_2005[,CMIP5_1981_2005]<0] <- 0
ET_eq_CMIP5_2076_2100[,CMIP5_2076_2100][ET_eq_CMIP5_2076_2100[,CMIP5_2076_2100]<0] <- 0

# Priestley-Taylor potential evapotranspiration with alpha set to 1.26
PET_PT_1.26_CMIP5_1981_2005 <- Ta_CMIP5_1981_2005
PET_PT_1.26_CMIP5_2076_2100 <- Ta_CMIP5_2076_2100

PET_PT_1.26_CMIP5_1981_2005[,CMIP5_1981_2005] <- alpha_PT*ET_eq_CMIP5_1981_2005[,CMIP5_1981_2005]
PET_PT_1.26_CMIP5_2076_2100[,CMIP5_2076_2100] <- alpha_PT*ET_eq_CMIP5_2076_2100[,CMIP5_2076_2100]

PET_PT_1.26_CMIP5_1981_2005$VAR <- 'PET_PT_alpha_1.26'
PET_PT_1.26_CMIP5_2076_2100$VAR <- 'PET_PT_alpha_1.26'

# Dynamic alpha
alpha_PT_CMIP5_1981_2005 <- Ta_CMIP5_1981_2005

alpha_PT_CMIP5_1981_2005[,CMIP5_1981_2005] <- ET_CMIP5_1981_2005[,CMIP5_1981_2005]/ET_eq_CMIP5_1981_2005[,CMIP5_1981_2005]

alpha_PT_CMIP5_1981_2005 <- alpha_PT_CMIP5_1981_2005[alpha_PT_CMIP5_1981_2005$MONTH %in% c('IV','V','VI','VII','VIII'),]
tmp <- apply(alpha_PT_CMIP5_1981_2005[,CMIP5_1981_2005],2,max)

alpha_PT_CMIP5_1981_2005 <- alpha_PT_CMIP5_1981_2005[1,]
alpha_PT_CMIP5_1981_2005[,CMIP5_1981_2005] <- tmp

alpha_PT_CMIP5_1981_2005$MONTH <- 'IV-VIII'
alpha_PT_CMIP5_1981_2005$VAR <- 'alpha_PT'

PET_PT_CMIP5_1981_2005 <- PET_PT_1.26_CMIP5_1981_2005
PET_PT_CMIP5_1981_2005$VAR <- 'PET_PT_alpha_dynamic'

for(i in CMIP5_1981_2005){
  PET_PT_CMIP5_1981_2005[,i] <- ET_eq_CMIP5_1981_2005[,i]*max(alpha_PT_CMIP5_1981_2005[i],alpha_PT)
}

# Check that annual sum of ET is not exceeding PET and correct it if yes
ET_CMIP5_a_1981_2005 <- annSums(ET_CMIP5_1981_2005[,CMIP5_1981_2005])
PET_CMIP5_a_1981_2005 <- annSums(PET_PT_CMIP5_1981_2005[,CMIP5_1981_2005])
ET_eq_CMIP5_a_1981_2005 <- annSums(ET_eq_CMIP5_1981_2005[,CMIP5_1981_2005])

tmp <- alpha_PT_CMIP5_1981_2005
tmp[,CMIP5_1981_2005] <- ET_CMIP5_a_1981_2005/ET_eq_CMIP5_a_1981_2005

for(i in CMIP5_1981_2005){
  alpha_PT_CMIP5_1981_2005[,i] <- ifelse(tmp[,i]>alpha_PT&tmp[,i]>alpha_PT_CMIP5_1981_2005[,i],
                                        tmp[,i], alpha_PT_CMIP5_1981_2005[,i])
  PET_PT_CMIP5_1981_2005[,i] <- ET_eq_CMIP5_1981_2005[,i]*max(alpha_PT_CMIP5_1981_2005[i],alpha_PT)
}
rm(list=c('ET_CMIP5_a_1981_2005','PET_CMIP5_a_1981_2005','ET_eq_CMIP5_a_1981_2005','tmp'))

PET_PT_CMIP5_2076_2100 <- PET_PT_1.26_CMIP5_2076_2100
PET_PT_CMIP5_2076_2100$VAR <- 'PET_PT_alpha_dynamic'

for(i in CMIP5_2076_2100){
  PET_PT_CMIP5_2076_2100[,i] <- ET_eq_CMIP5_2076_2100[,i]*max(alpha_PT_CMIP5_1981_2005[i],alpha_PT)
}

#-----
# CMIP6

LE_CMIP6_1981_2005 <- CMIP6_1981_2005_data[which(CMIP6_1981_2005_data$VAR=='LE'),]
LE_CMIP6_2076_2100 <- CMIP6_2076_2100_data[which(CMIP6_2076_2100_data$VAR=='LE'),]

H_CMIP6_1981_2005 <- CMIP6_1981_2005_data[which(CMIP6_1981_2005_data$VAR=='H'),]
H_CMIP6_2076_2100 <- CMIP6_2076_2100_data[which(CMIP6_2076_2100_data$VAR=='H'),]

Rg_CMIP6_1981_2005 <- CMIP6_1981_2005_data[which(CMIP6_1981_2005_data$VAR=='Rg'),]
Rg_CMIP6_2076_2100 <- CMIP6_2076_2100_data[which(CMIP6_2076_2100_data$VAR=='Rg'),]

SW_net_CMIP6_1981_2005 <- CMIP6_1981_2005_data[which(CMIP6_1981_2005_data$VAR=='SW_net'),]
SW_net_CMIP6_2076_2100 <- CMIP6_2076_2100_data[which(CMIP6_2076_2100_data$VAR=='SW_net'),]

LW_net_CMIP6_1981_2005 <- CMIP6_1981_2005_data[which(CMIP6_1981_2005_data$VAR=='LW_net'),]
LW_net_CMIP6_2076_2100 <- CMIP6_2076_2100_data[which(CMIP6_2076_2100_data$VAR=='LW_net'),]

# Correct the sign
LW_net_CMIP6_1981_2005[,CMIP6_1981_2005] <- (-1)*LW_net_CMIP6_1981_2005[,CMIP6_1981_2005]
LW_net_CMIP6_2076_2100[,CMIP6_2076_2100] <- (-1)*LW_net_CMIP6_2076_2100[,CMIP6_2076_2100]

Rn_CMIP6_1981_2005 <- SW_net_CMIP6_1981_2005
Rn_CMIP6_1981_2005[,CMIP6_1981_2005] <- SW_net_CMIP6_1981_2005[,CMIP6_1981_2005]+LW_net_CMIP6_1981_2005[,CMIP6_1981_2005]
Rn_CMIP6_2076_2100 <- SW_net_CMIP6_2076_2100
Rn_CMIP6_2076_2100[,CMIP6_1981_2005] <- SW_net_CMIP6_2076_2100[,CMIP6_2076_2100]+LW_net_CMIP6_2076_2100[,CMIP6_2076_2100]
Rn_CMIP6_1981_2005$VAR <- 'Rn'
Rn_CMIP6_2076_2100$VAR <- 'Rn'

G_CMIP6_1981_2005 <- Rn_CMIP6_1981_2005
G_CMIP6_1981_2005[,CMIP6_1981_2005] <- Rn_CMIP6_1981_2005[,CMIP6_1981_2005]-H_CMIP6_1981_2005[,CMIP6_1981_2005]-LE_CMIP6_1981_2005[,CMIP6_1981_2005]
G_CMIP6_2076_2100 <- Rn_CMIP6_2076_2100
G_CMIP6_2076_2100[,CMIP6_2076_2100] <- Rn_CMIP6_2076_2100[,CMIP6_2076_2100]-H_CMIP6_2076_2100[,CMIP6_2076_2100]-LE_CMIP6_2076_2100[,CMIP6_2076_2100]
G_CMIP6_1981_2005$VAR <- 'G'
G_CMIP6_2076_2100$VAR <- 'G'

P_CMIP6_1981_2005 <- CMIP6_1981_2005_data[which(CMIP6_1981_2005_data$VAR=='P'),]
P_CMIP6_2076_2100 <- CMIP6_2076_2100_data[which(CMIP6_2076_2100_data$VAR=='P'),]

Ta_CMIP6_1981_2005 <- CMIP6_1981_2005_data[which(CMIP6_1981_2005_data$VAR=='Ta'),]
Ta_CMIP6_2076_2100 <- CMIP6_2076_2100_data[which(CMIP6_2076_2100_data$VAR=='Ta'),]

n_days_CMIP6 <- matrix(rep(c(31,28.25,31,30,31,30,31,31,30,31,30,31),ncol(CMIP6_1981_2005_data)-4),nrow=12,ncol=ncol(CMIP6_1981_2005_data)-4)
ET_CMIP6_1981_2005 <- LE_CMIP6_1981_2005
ET_CMIP6_1981_2005[,CMIP6_1981_2005] <- LE_CMIP6_1981_2005[,CMIP6_1981_2005]*n_days_CMIP6*W_to_mm
ET_CMIP6_2076_2100 <- LE_CMIP6_2076_2100
ET_CMIP6_2076_2100[,CMIP6_2076_2100] <- LE_CMIP6_2076_2100[,CMIP6_2076_2100]*n_days_CMIP6*W_to_mm
### ET_CMIP6_2076_2100 <- LE_CMIP6_2076_2100


# Clausius-Clapeyron
e_sat_CMIP6_1981_2005 <- Ta_CMIP6_1981_2005
e_sat_CMIP6_2076_2100 <- Ta_CMIP6_2076_2100

e_sat_CMIP6_1981_2005[,CMIP6_1981_2005] <- a*exp(b*Ta_CMIP6_1981_2005[,CMIP6_1981_2005]/(Ta_CMIP6_1981_2005[,CMIP6_1981_2005]+c))
e_sat_CMIP6_2076_2100[,CMIP6_2076_2100] <- a*exp(b*Ta_CMIP6_2076_2100[,CMIP6_2076_2100]/(Ta_CMIP6_2076_2100[,CMIP6_2076_2100]+c))
e_sat_CMIP6_1981_2005$VAR <- 'e_sat'
e_sat_CMIP6_2076_2100$VAR <- 'e_sat'


SVP_CMIP6_1981_2005 <- Ta_CMIP6_1981_2005
SVP_CMIP6_2076_2100 <- Ta_CMIP6_2076_2100

SVP_CMIP6_1981_2005[,CMIP6_1981_2005] <- b*c* e_sat_CMIP6_1981_2005[,CMIP6_1981_2005]/(c + Ta_CMIP6_1981_2005[,CMIP6_1981_2005])^2
SVP_CMIP6_2076_2100[,CMIP6_2076_2100] <- b*c* e_sat_CMIP6_2076_2100[,CMIP6_2076_2100]/(c + Ta_CMIP6_2076_2100[,CMIP6_2076_2100])^2
SVP_CMIP6_1981_2005$VAR <- 'SVP'
SVP_CMIP6_2076_2100$VAR <- 'SVP'

# Equilibrium evaporation
ET_eq_CMIP6_1981_2005 <- Ta_CMIP6_1981_2005
ET_eq_CMIP6_2076_2100 <- Ta_CMIP6_2076_2100

ET_eq_CMIP6_1981_2005[,CMIP6_1981_2005] <- SVP_CMIP6_1981_2005[,CMIP6_1981_2005]*(Rn_CMIP6_1981_2005[,CMIP6_1981_2005]-G_CMIP6_1981_2005[,CMIP6_1981_2005])/(SVP_CMIP6_1981_2005[,CMIP6_1981_2005] + gamma)*n_days_CMIP6*W_to_mm
ET_eq_CMIP6_2076_2100[,CMIP6_2076_2100] <- SVP_CMIP6_2076_2100[,CMIP6_2076_2100]*(Rn_CMIP6_2076_2100[,CMIP6_2076_2100]-G_CMIP6_2076_2100[,CMIP6_2076_2100])/(SVP_CMIP6_2076_2100[,CMIP6_2076_2100] + gamma)*n_days_CMIP6*W_to_mm

ET_eq_CMIP6_1981_2005$VAR <- 'Equilibrium_ET'
ET_eq_CMIP6_2076_2100$VAR <- 'Equilibrium_ET'

# Replace negative values by zero
ET_eq_CMIP6_1981_2005[,CMIP6_1981_2005][ET_eq_CMIP6_1981_2005[,CMIP6_1981_2005]<0] <- 0
ET_eq_CMIP6_2076_2100[,CMIP6_2076_2100][ET_eq_CMIP6_2076_2100[,CMIP6_2076_2100]<0] <- 0

# Priestley-Taylor potential evapotranspiration with alpha set to 1.26
PET_PT_1.26_CMIP6_1981_2005 <- Ta_CMIP6_1981_2005
PET_PT_1.26_CMIP6_2076_2100 <- Ta_CMIP6_2076_2100

PET_PT_1.26_CMIP6_1981_2005[,CMIP6_1981_2005] <- alpha_PT*ET_eq_CMIP6_1981_2005[,CMIP6_1981_2005]
PET_PT_1.26_CMIP6_2076_2100[,CMIP6_2076_2100] <- alpha_PT*ET_eq_CMIP6_2076_2100[,CMIP6_2076_2100]

PET_PT_1.26_CMIP6_1981_2005$VAR <- 'PET_PT_alpha_1.26'
PET_PT_1.26_CMIP6_2076_2100$VAR <- 'PET_PT_alpha_1.26'

# Dynamic alpha
alpha_PT_CMIP6_1981_2005 <- Ta_CMIP6_1981_2005

alpha_PT_CMIP6_1981_2005[,CMIP6_1981_2005] <- ET_CMIP6_1981_2005[,CMIP6_1981_2005]/ET_eq_CMIP6_1981_2005[,CMIP6_1981_2005]

alpha_PT_CMIP6_1981_2005 <- alpha_PT_CMIP6_1981_2005[alpha_PT_CMIP6_1981_2005$MONTH %in% c('IV','V','VI','VII','VIII'),]
tmp <- apply(alpha_PT_CMIP6_1981_2005[,CMIP6_1981_2005],2,max)

alpha_PT_CMIP6_1981_2005 <- alpha_PT_CMIP6_1981_2005[1,]
alpha_PT_CMIP6_1981_2005[,CMIP6_1981_2005] <- tmp

alpha_PT_CMIP6_1981_2005$MONTH <- 'IV-VIII'
alpha_PT_CMIP6_1981_2005$VAR <- 'alpha_PT'

PET_PT_CMIP6_1981_2005 <- PET_PT_1.26_CMIP6_1981_2005
PET_PT_CMIP6_1981_2005$VAR <- 'PET_PT_alpha_dynamic'

for(i in CMIP6_1981_2005){
  PET_PT_CMIP6_1981_2005[,i] <- ET_eq_CMIP6_1981_2005[,i]*max(alpha_PT_CMIP6_1981_2005[i],alpha_PT)
}

# Check that annual sum of ET is not exceeding PET and correct it if yes
ET_CMIP6_a_1981_2005 <- annSums(ET_CMIP6_1981_2005[,CMIP6_1981_2005])
PET_CMIP6_a_1981_2005 <- annSums(PET_PT_CMIP6_1981_2005[,CMIP6_1981_2005])
ET_eq_CMIP6_a_1981_2005 <- annSums(ET_eq_CMIP6_1981_2005[,CMIP6_1981_2005])

tmp <- alpha_PT_CMIP6_1981_2005
tmp[,CMIP6_1981_2005] <- ET_CMIP6_a_1981_2005/ET_eq_CMIP6_a_1981_2005

for(i in CMIP6_1981_2005){
  alpha_PT_CMIP6_1981_2005[,i] <- ifelse(tmp[,i]>alpha_PT&tmp[,i]>alpha_PT_CMIP6_1981_2005[,i],
                                         tmp[,i], alpha_PT_CMIP6_1981_2005[,i])
  PET_PT_CMIP6_1981_2005[,i] <- ET_eq_CMIP6_1981_2005[,i]*max(alpha_PT_CMIP6_1981_2005[i],alpha_PT)
}
rm(list=c('ET_CMIP6_a_1981_2005','PET_CMIP6_a_1981_2005','ET_eq_CMIP6_a_1981_2005','tmp'))

PET_PT_CMIP6_2076_2100 <- PET_PT_1.26_CMIP6_2076_2100
PET_PT_CMIP6_2076_2100$VAR <- 'PET_PT_alpha_dynamic'

for(i in CMIP6_2076_2100){
  PET_PT_CMIP6_2076_2100[,i] <- ET_eq_CMIP6_2076_2100[,i]*max(alpha_PT_CMIP6_1981_2005[i],alpha_PT)
}

#-----
# RCMs

LE_RCMs_1981_2005 <- RCMs_1981_2005_data[which(RCMs_1981_2005_data$VAR=='LE'),]
LE_RCMs_2076_2100 <- RCMs_2076_2100_data[which(RCMs_2076_2100_data$VAR=='LE'),]

H_RCMs_1981_2005 <- RCMs_1981_2005_data[which(RCMs_1981_2005_data$VAR=='H'),]
H_RCMs_2076_2100 <- RCMs_2076_2100_data[which(RCMs_2076_2100_data$VAR=='H'),]

Rg_RCMs_1981_2005 <- RCMs_1981_2005_data[which(RCMs_1981_2005_data$VAR=='Rg'),]
Rg_RCMs_2076_2100 <- RCMs_2076_2100_data[which(RCMs_2076_2100_data$VAR=='Rg'),]

SW_net_RCMs_1981_2005 <- RCMs_1981_2005_data[which(RCMs_1981_2005_data$VAR=='SW_net'),]
SW_net_RCMs_2076_2100 <- RCMs_2076_2100_data[which(RCMs_2076_2100_data$VAR=='SW_net'),]

LW_net_RCMs_1981_2005 <- RCMs_1981_2005_data[which(RCMs_1981_2005_data$VAR=='LW_net'),]
LW_net_RCMs_2076_2100 <- RCMs_2076_2100_data[which(RCMs_2076_2100_data$VAR=='LW_net'),]

# Correct the sign
LW_net_RCMs_1981_2005[,RCMs_1981_2005] <- (-1)*LW_net_RCMs_1981_2005[,RCMs_1981_2005]
LW_net_RCMs_2076_2100[,RCMs_2076_2100] <- (-1)*LW_net_RCMs_2076_2100[,RCMs_2076_2100]

Rn_RCMs_1981_2005 <- SW_net_RCMs_1981_2005
Rn_RCMs_1981_2005[,RCMs_1981_2005] <- SW_net_RCMs_1981_2005[,RCMs_1981_2005]+LW_net_RCMs_1981_2005[,RCMs_1981_2005]
Rn_RCMs_2076_2100 <- SW_net_RCMs_2076_2100
Rn_RCMs_2076_2100[,RCMs_1981_2005] <- SW_net_RCMs_2076_2100[,RCMs_2076_2100]+LW_net_RCMs_2076_2100[,RCMs_2076_2100]
Rn_RCMs_1981_2005$VAR <- 'Rn'
Rn_RCMs_2076_2100$VAR <- 'Rn'

G_RCMs_1981_2005 <- Rn_RCMs_1981_2005
G_RCMs_1981_2005[,RCMs_1981_2005] <- Rn_RCMs_1981_2005[,RCMs_1981_2005]-H_RCMs_1981_2005[,RCMs_1981_2005]-LE_RCMs_1981_2005[,RCMs_1981_2005]
G_RCMs_2076_2100 <- Rn_RCMs_2076_2100
G_RCMs_2076_2100[,RCMs_2076_2100] <- Rn_RCMs_2076_2100[,RCMs_2076_2100]-H_RCMs_2076_2100[,RCMs_2076_2100]-LE_RCMs_2076_2100[,RCMs_2076_2100]
G_RCMs_1981_2005$VAR <- 'G'
G_RCMs_2076_2100$VAR <- 'G'

P_RCMs_1981_2005 <- RCMs_1981_2005_data[which(RCMs_1981_2005_data$VAR=='P'),]
P_RCMs_2076_2100 <- RCMs_2076_2100_data[which(RCMs_2076_2100_data$VAR=='P'),]

Ta_RCMs_1981_2005 <- RCMs_1981_2005_data[which(RCMs_1981_2005_data$VAR=='Ta'),]
Ta_RCMs_2076_2100 <- RCMs_2076_2100_data[which(RCMs_2076_2100_data$VAR=='Ta'),]

n_days_RCMs <- matrix(rep(c(31,28.25,31,30,31,30,31,31,30,31,30,31),ncol(RCMs_1981_2005_data)-4),nrow=12,ncol=ncol(RCMs_1981_2005_data)-4)
ET_RCMs_1981_2005 <- LE_RCMs_1981_2005
ET_RCMs_1981_2005[,RCMs_1981_2005] <- LE_RCMs_1981_2005[,RCMs_1981_2005]*n_days_RCMs*W_to_mm
ET_RCMs_2076_2100 <- LE_RCMs_2076_2100
ET_RCMs_2076_2100[,RCMs_2076_2100] <- LE_RCMs_2076_2100[,RCMs_2076_2100]*n_days_RCMs*W_to_mm
### ET_RCMs_2076_2100 <- LE_RCMs_2076_2100

# Clausius-Clapeyron
e_sat_RCMs_1981_2005 <- Ta_RCMs_1981_2005
e_sat_RCMs_2076_2100 <- Ta_RCMs_2076_2100

e_sat_RCMs_1981_2005[,RCMs_1981_2005] <- a*exp(b*Ta_RCMs_1981_2005[,RCMs_1981_2005]/(Ta_RCMs_1981_2005[,RCMs_1981_2005]+c))
e_sat_RCMs_2076_2100[,RCMs_2076_2100] <- a*exp(b*Ta_RCMs_2076_2100[,RCMs_2076_2100]/(Ta_RCMs_2076_2100[,RCMs_2076_2100]+c))

e_sat_RCMs_1981_2005$VAR <- 'e_sat'
e_sat_RCMs_2076_2100$VAR <- 'e_sat'

SVP_RCMs_1981_2005 <- Ta_RCMs_1981_2005
SVP_RCMs_2076_2100 <- Ta_RCMs_2076_2100

SVP_RCMs_1981_2005[,RCMs_1981_2005] <- b*c* e_sat_RCMs_1981_2005[,RCMs_1981_2005]/(c + Ta_RCMs_1981_2005[,RCMs_1981_2005])^2
SVP_RCMs_2076_2100[,RCMs_2076_2100] <- b*c* e_sat_RCMs_2076_2100[,RCMs_2076_2100]/(c + Ta_RCMs_2076_2100[,RCMs_2076_2100])^2

SVP_RCMs_1981_2005$VAR <- 'SVP'
SVP_RCMs_2076_2100$VAR <- 'SVP'

# Equilibrium evaporation
ET_eq_RCMs_1981_2005 <- Ta_RCMs_1981_2005
ET_eq_RCMs_2076_2100 <- Ta_RCMs_2076_2100

ET_eq_RCMs_1981_2005[,RCMs_1981_2005] <- SVP_RCMs_1981_2005[,RCMs_1981_2005]*(Rn_RCMs_1981_2005[,RCMs_1981_2005]-G_RCMs_1981_2005[,RCMs_1981_2005])/(SVP_RCMs_1981_2005[,RCMs_1981_2005] + gamma)*n_days_RCMs*W_to_mm
ET_eq_RCMs_2076_2100[,RCMs_2076_2100] <- SVP_RCMs_2076_2100[,RCMs_2076_2100]*(Rn_RCMs_2076_2100[,RCMs_2076_2100]-G_RCMs_2076_2100[,RCMs_2076_2100])/(SVP_RCMs_2076_2100[,RCMs_2076_2100] + gamma)*n_days_RCMs*W_to_mm

ET_eq_RCMs_1981_2005$VAR <- 'Equilibrium_ET'
ET_eq_RCMs_2076_2100$VAR <- 'Equilibrium_ET'

# Replace negative values by zero
ET_eq_RCMs_1981_2005[,RCMs_1981_2005][ET_eq_RCMs_1981_2005[,RCMs_1981_2005]<0] <- 0
ET_eq_RCMs_2076_2100[,RCMs_2076_2100][ET_eq_RCMs_2076_2100[,RCMs_2076_2100]<0] <- 0

# Priestley-Taylor potential evapotranspiration with alpha set to 1.26
PET_PT_1.26_RCMs_1981_2005 <- Ta_RCMs_1981_2005
PET_PT_1.26_RCMs_2076_2100 <- Ta_RCMs_2076_2100

PET_PT_1.26_RCMs_1981_2005[,RCMs_1981_2005] <- alpha_PT*ET_eq_RCMs_1981_2005[,RCMs_1981_2005]
PET_PT_1.26_RCMs_2076_2100[,RCMs_2076_2100] <- alpha_PT*ET_eq_RCMs_2076_2100[,RCMs_2076_2100]

PET_PT_1.26_RCMs_1981_2005$VAR <- 'PET_PT_alpha_1.26'
PET_PT_1.26_RCMs_2076_2100$VAR <- 'PET_PT_alpha_1.26'

# Dynamic alpha
alpha_PT_RCMs_1981_2005 <- Ta_RCMs_1981_2005

alpha_PT_RCMs_1981_2005[,RCMs_1981_2005] <- ET_RCMs_1981_2005[,RCMs_1981_2005]/ET_eq_RCMs_1981_2005[,RCMs_1981_2005]

alpha_PT_RCMs_1981_2005 <- alpha_PT_RCMs_1981_2005[alpha_PT_RCMs_1981_2005$MONTH %in% c('IV','V','VI','VII','VIII'),]
tmp <- apply(alpha_PT_RCMs_1981_2005[,RCMs_1981_2005],2,max)

alpha_PT_RCMs_1981_2005 <- alpha_PT_RCMs_1981_2005[1,]
alpha_PT_RCMs_1981_2005[,RCMs_1981_2005] <- tmp

alpha_PT_RCMs_1981_2005$MONTH <- 'IV-VIII'
alpha_PT_RCMs_1981_2005$VAR <- 'alpha_PT'

PET_PT_RCMs_1981_2005 <- PET_PT_1.26_RCMs_1981_2005
PET_PT_RCMs_1981_2005$VAR <- 'PET_PT_alpha_dynamic'

for(i in RCMs_1981_2005){
  PET_PT_RCMs_1981_2005[,i] <- ET_eq_RCMs_1981_2005[,i]*max(alpha_PT_RCMs_1981_2005[i],alpha_PT)
}

# Check that annual sum of ET is not exceeding PET and correct it if yes
ET_RCMs_a_1981_2005 <- annSums(ET_RCMs_1981_2005[,RCMs_1981_2005])
PET_RCMs_a_1981_2005 <- annSums(PET_PT_RCMs_1981_2005[,RCMs_1981_2005])
ET_eq_RCMs_a_1981_2005 <- annSums(ET_eq_RCMs_1981_2005[,RCMs_1981_2005])

tmp <- alpha_PT_RCMs_1981_2005
tmp[,RCMs_1981_2005] <- ET_RCMs_a_1981_2005/ET_eq_RCMs_a_1981_2005

for(i in RCMs_1981_2005){
  alpha_PT_RCMs_1981_2005[,i] <- ifelse(tmp[,i]>alpha_PT&tmp[,i]>alpha_PT_RCMs_1981_2005[,i],
                                        tmp[,i], alpha_PT_RCMs_1981_2005[,i])
  PET_PT_RCMs_1981_2005[,i] <- ET_eq_RCMs_1981_2005[,i]*max(alpha_PT_RCMs_1981_2005[i],alpha_PT)
}
rm(list=c('ET_RCMs_a_1981_2005','PET_RCMs_a_1981_2005','ET_eq_RCMs_a_1981_2005','tmp'))

PET_PT_RCMs_2076_2100 <- PET_PT_1.26_RCMs_2076_2100
PET_PT_RCMs_2076_2100$VAR <- 'PET_PT_alpha_dynamic'

for(i in RCMs_2076_2100){
  PET_PT_RCMs_2076_2100[,i] <- ET_eq_RCMs_2076_2100[,i]*max(alpha_PT_RCMs_1981_2005[i],alpha_PT)
}

##################################
# The deviations from the baseline

#-----
# CMIP5

d_LE_CMIP5 <- LE_CMIP5_2076_2100; d_LE_CMIP5$PERIOD <- '2076_2100-1981_2005'
d_LE_CMIP5[,CMIP5_2076_2100] <- LE_CMIP5_2076_2100[,CMIP5_2076_2100]-LE_CMIP5_1981_2005[,CMIP5_2076_2100]
d_H_CMIP5 <- H_CMIP5_2076_2100; H_CMIP5_2076_2100$PERIOD <- '2076_2100-1981_2005'
d_H_CMIP5[,CMIP5_2076_2100] <- d_H_CMIP5[,CMIP5_2076_2100]-H_CMIP5_1981_2005[,CMIP5_2076_2100]

d_Rg_CMIP5 <- Rg_CMIP5_2076_2100; d_Rg_CMIP5$PERIOD <- '2076_2100-1981_2005'
d_Rg_CMIP5[,CMIP5_2076_2100] <- Rg_CMIP5_2076_2100[,CMIP5_2076_2100]-Rg_CMIP5_1981_2005[,CMIP5_2076_2100]
d_SW_net_CMIP5 <- SW_net_CMIP5_2076_2100; d_SW_net_CMIP5$PERIOD <- '2076_2100-1981_2005'
d_SW_net_CMIP5[,CMIP5_2076_2100] <- SW_net_CMIP5_2076_2100[,CMIP5_2076_2100]-SW_net_CMIP5_1981_2005[,CMIP5_2076_2100]
d_LW_net_CMIP5 <- LW_net_CMIP5_2076_2100; d_LW_net_CMIP5$PERIOD <- '2076_2100-1981_2005'
d_LW_net_CMIP5[,CMIP5_2076_2100] <- LW_net_CMIP5_2076_2100[,CMIP5_2076_2100]-LW_net_CMIP5_1981_2005[,CMIP5_2076_2100]
d_Rn_CMIP5 <- Rn_CMIP5_2076_2100; d_Rn_CMIP5$PERIOD <- '2076_2100-1981_2005'
d_Rn_CMIP5[,CMIP5_2076_2100] <- Rn_CMIP5_2076_2100[,CMIP5_2076_2100]-Rn_CMIP5_1981_2005[,CMIP5_2076_2100]

d_P_CMIP5 <- P_CMIP5_2076_2100; d_P_CMIP5$PERIOD <- '2076_2100-1981_2005'
d_P_CMIP5[,CMIP5_2076_2100] <- P_CMIP5_2076_2100[,CMIP5_2076_2100]-P_CMIP5_1981_2005[,CMIP5_2076_2100]
d_Ta_CMIP5 <- Ta_CMIP5_2076_2100; d_Ta_CMIP5$PERIOD <- '2076_2100-1981_2005'
d_Ta_CMIP5[,CMIP5_2076_2100] <- Ta_CMIP5_2076_2100[,CMIP5_2076_2100]-Ta_CMIP5_1981_2005[,CMIP5_2076_2100]

d_e_sat_CMIP5 <- e_sat_CMIP5_2076_2100; d_e_sat_CMIP5$PERIOD <- '2076_2100-1981_2005'
d_e_sat_CMIP5[,CMIP5_2076_2100] <- e_sat_CMIP5_2076_2100[,CMIP5_2076_2100]-e_sat_CMIP5_1981_2005[,CMIP5_2076_2100]

d_ET_CMIP5 <- ET_CMIP5_2076_2100; d_ET_CMIP5$PERIOD <- '2076_2100-1981_2005'
d_ET_CMIP5[,CMIP5_2076_2100] <- ET_CMIP5_2076_2100[,CMIP5_2076_2100]-ET_CMIP5_1981_2005[,CMIP5_2076_2100]

d_PET_PT_1.26_CMIP5 <- PET_PT_1.26_CMIP5_2076_2100; d_PET_PT_1.26_CMIP5$PERIOD <- '2076_2100-1981_2005'
d_PET_PT_1.26_CMIP5[,CMIP5_2076_2100] <- PET_PT_1.26_CMIP5_2076_2100[,CMIP5_2076_2100]-PET_PT_1.26_CMIP5_1981_2005[,CMIP5_2076_2100]

#-----
# CMIP6

d_LE_CMIP6 <- LE_CMIP6_2076_2100; d_LE_CMIP6$PERIOD <- '2076_2100-1981_2005'
d_LE_CMIP6[,CMIP6_2076_2100] <- LE_CMIP6_2076_2100[,CMIP6_2076_2100]-LE_CMIP6_1981_2005[,CMIP6_2076_2100]
d_H_CMIP6 <- H_CMIP6_2076_2100; H_CMIP6_2076_2100$PERIOD <- '2076_2100-1981_2005'
d_H_CMIP6[,CMIP6_2076_2100] <- d_H_CMIP6[,CMIP6_2076_2100]-H_CMIP6_1981_2005[,CMIP6_2076_2100]

d_Rg_CMIP6 <- Rg_CMIP6_2076_2100; d_Rg_CMIP6$PERIOD <- '2076_2100-1981_2005'
d_Rg_CMIP6[,CMIP6_2076_2100] <- Rg_CMIP6_2076_2100[,CMIP6_2076_2100]-Rg_CMIP6_1981_2005[,CMIP6_2076_2100]
d_SW_net_CMIP6 <- SW_net_CMIP6_2076_2100; d_SW_net_CMIP6$PERIOD <- '2076_2100-1981_2005'
d_SW_net_CMIP6[,CMIP6_2076_2100] <- SW_net_CMIP6_2076_2100[,CMIP6_2076_2100]-SW_net_CMIP6_1981_2005[,CMIP6_2076_2100]
d_LW_net_CMIP6 <- LW_net_CMIP6_2076_2100; d_LW_net_CMIP6$PERIOD <- '2076_2100-1981_2005'
d_LW_net_CMIP6[,CMIP6_2076_2100] <- LW_net_CMIP6_2076_2100[,CMIP6_2076_2100]-LW_net_CMIP6_1981_2005[,CMIP6_2076_2100]
d_Rn_CMIP6 <- Rn_CMIP6_2076_2100; d_Rn_CMIP6$PERIOD <- '2076_2100-1981_2005'
d_Rn_CMIP6[,CMIP6_2076_2100] <- Rn_CMIP6_2076_2100[,CMIP6_2076_2100]-Rn_CMIP6_1981_2005[,CMIP6_2076_2100]

d_P_CMIP6 <- P_CMIP6_2076_2100; d_P_CMIP6$PERIOD <- '2076_2100-1981_2005'
d_P_CMIP6[,CMIP6_2076_2100] <- P_CMIP6_2076_2100[,CMIP6_2076_2100]-P_CMIP6_1981_2005[,CMIP6_2076_2100]
d_Ta_CMIP6 <- Ta_CMIP6_2076_2100; d_Ta_CMIP6$PERIOD <- '2076_2100-1981_2005'
d_Ta_CMIP6[,CMIP6_2076_2100] <- Ta_CMIP6_2076_2100[,CMIP6_2076_2100]-Ta_CMIP6_1981_2005[,CMIP6_2076_2100]

d_e_sat_CMIP6 <- e_sat_CMIP6_2076_2100; d_e_sat_CMIP6$PERIOD <- '2076_2100-1981_2005'
d_e_sat_CMIP6[,CMIP6_2076_2100] <- e_sat_CMIP6_2076_2100[,CMIP6_2076_2100]-e_sat_CMIP6_1981_2005[,CMIP6_2076_2100]

d_ET_CMIP6 <- ET_CMIP6_2076_2100; d_ET_CMIP6$PERIOD <- '2076_2100-1981_2005'
d_ET_CMIP6[,CMIP6_2076_2100] <- ET_CMIP6_2076_2100[,CMIP6_2076_2100]-ET_CMIP6_1981_2005[,CMIP6_2076_2100]

d_PET_PT_1.26_CMIP6 <- PET_PT_1.26_CMIP6_2076_2100; d_PET_PT_1.26_CMIP6$PERIOD <- '2076_2100-1981_2005'
d_PET_PT_1.26_CMIP6[,CMIP6_2076_2100] <- PET_PT_1.26_CMIP6_2076_2100[,CMIP6_2076_2100]-PET_PT_1.26_CMIP6_1981_2005[,CMIP6_2076_2100]

#-----
# RCMs

d_LE_RCMs <- LE_RCMs_2076_2100; d_LE_RCMs$PERIOD <- '2076_2100-1981_2005'
d_LE_RCMs[,RCMs_2076_2100] <- LE_RCMs_2076_2100[,RCMs_2076_2100]-LE_RCMs_1981_2005[,RCMs_2076_2100]
d_H_RCMs <- H_RCMs_2076_2100; H_RCMs_2076_2100$PERIOD <- '2076_2100-1981_2005'
d_H_RCMs[,RCMs_2076_2100] <- d_H_RCMs[,RCMs_2076_2100]-H_RCMs_1981_2005[,RCMs_2076_2100]

d_Rg_RCMs <- Rg_RCMs_2076_2100; d_Rg_RCMs$PERIOD <- '2076_2100-1981_2005'
d_Rg_RCMs[,RCMs_2076_2100] <- Rg_RCMs_2076_2100[,RCMs_2076_2100]-Rg_RCMs_1981_2005[,RCMs_2076_2100]
d_SW_net_RCMs <- SW_net_RCMs_2076_2100; d_SW_net_RCMs$PERIOD <- '2076_2100-1981_2005'
d_SW_net_RCMs[,RCMs_2076_2100] <- SW_net_RCMs_2076_2100[,RCMs_2076_2100]-SW_net_RCMs_1981_2005[,RCMs_2076_2100]
d_LW_net_RCMs <- LW_net_RCMs_2076_2100; d_LW_net_RCMs$PERIOD <- '2076_2100-1981_2005'
d_LW_net_RCMs[,RCMs_2076_2100] <- LW_net_RCMs_2076_2100[,RCMs_2076_2100]-LW_net_RCMs_1981_2005[,RCMs_2076_2100]
d_Rn_RCMs <- Rn_RCMs_2076_2100; d_Rn_RCMs$PERIOD <- '2076_2100-1981_2005'
d_Rn_RCMs[,RCMs_2076_2100] <- Rn_RCMs_2076_2100[,RCMs_2076_2100]-Rn_RCMs_1981_2005[,RCMs_2076_2100]

d_P_RCMs <- P_RCMs_2076_2100; d_P_RCMs$PERIOD <- '2076_2100-1981_2005'
d_P_RCMs[,RCMs_2076_2100] <- P_RCMs_2076_2100[,RCMs_2076_2100]-P_RCMs_1981_2005[,RCMs_2076_2100]
d_Ta_RCMs <- Ta_RCMs_2076_2100; d_Ta_RCMs$PERIOD <- '2076_2100-1981_2005'
d_Ta_RCMs[,RCMs_2076_2100] <- Ta_RCMs_2076_2100[,RCMs_2076_2100]-Ta_RCMs_1981_2005[,RCMs_2076_2100]

d_e_sat_RCMs <- e_sat_RCMs_2076_2100; d_e_sat_RCMs$PERIOD <- '2076_2100-1981_2005'
d_e_sat_RCMs[,RCMs_2076_2100] <- e_sat_RCMs_2076_2100[,RCMs_2076_2100]-e_sat_RCMs_1981_2005[,RCMs_2076_2100]

d_ET_RCMs <- ET_RCMs_2076_2100; d_ET_RCMs$PERIOD <- '2076_2100-1981_2005'
d_ET_RCMs[,RCMs_2076_2100] <- ET_RCMs_2076_2100[,RCMs_2076_2100]-ET_RCMs_1981_2005[,RCMs_2076_2100]

d_PET_PT_1.26_RCMs <- PET_PT_1.26_RCMs_2076_2100; d_PET_PT_1.26_RCMs$PERIOD <- '2076_2100-1981_2005'
d_PET_PT_1.26_RCMs[,RCMs_2076_2100] <- PET_PT_1.26_RCMs_2076_2100[,RCMs_2076_2100]-PET_PT_1.26_RCMs_1981_2005[,RCMs_2076_2100]

